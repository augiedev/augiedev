<apex:page tabStyle="Account" controller="GoogleMapsExtensions" showHeader="false" sidebar="false">
<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>

<link href="http://code.google.com/apis/maps/documentation/javascript/examples/default.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false" />
<script type="text/javascript">

function initialize() {

   position = 0;
   var accounts = new Array (
      new Array("{!headAccount.id}", "{!headAccount.Name}", "{!headAccount.BillingStreet}", "{!headAccount.BillingCity}", "{!headAccount.BillingPostalCode}", "{!headAccount.BillingCountry}", 0, 0, position++)
   <apex:repeat value="{!zoneAccs}" var="acc">
      , new Array ("{!acc.id}", "{!acc.Name}", "{!acc.BillingStreet}", "{!acc.BillingCity}", "{!acc.BillingPostalCode}", "{!acc.BillingCountry}", 0, 0, position++)
   </apex:repeat>
   );

   for (i = 0; i < accounts.length; i++) {
      var geocoder = new google.maps.Geocoder();
      // format Street, City, PostalCode, Country
      var address = accounts[i][2] + ", " + accounts[i][3] + ", " + accounts[i][4] + ", " + accounts[i][5]; 
      var pos = 0;   
      geocoder.geocode( { address: address}, function(results, status) {
         if (status == google.maps.GeocoderStatus.OK && results.length) {
            if (status != google.maps.GeocoderStatus.ZERO_RESULTS) {     
               accounts[pos][6] = results[0].geometry.location.lat();
               accounts[pos][7] = results[0].geometry.location.lng();
               pos++;
            }        
         }
       
      });
   }

   setMarkers(accounts);   
}

function setMarkers(accounts) {

   while (accounts[0][6] == 0 && accounts[0][7] == 0) {
   }
   
    var myOptions = {
       zoom: 12,
       //center: new google.maps.LatLng(51.863432,4.520956),
       center: new google.maps.LatLng(accounts[0][6], accounts[0][7]),
       mapTypeId: google.maps.MapTypeId.ROADMAP
    }
    var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);   
   var infowindow = null;

   for (var i = 0; i < accounts.length; i++) {
      var myLatLng = new google.maps.LatLng(accounts[i][6], accounts[i][7]);
      infowindow = new google.maps.InfoWindow({
         content: "Loading..."
      });    
      var marker = new google.maps.Marker({
         position: myLatLng,
         map: map,
         title: accounts[i][1],
         zIndex: accounts[i][8],
         html: "<b><a target='_blank' href='/"+accounts[i][0]+"'>"+accounts[i][1]+"</a></b><br/>"+accounts[i][2]+"<br/>"+accounts[i][3]+", "+accounts[i][4]
      });

      //add listeners to display cloud
      google.maps.event.addListener(marker, 'click', function() {
         infowindow.setContent(this.html);
         infowindow.open(map,this);
      });
   }
}
</script>
</head>
<body onload="initialize()">
  <div id="map_canvas"></div>
</body>
</html>

</apex:page>